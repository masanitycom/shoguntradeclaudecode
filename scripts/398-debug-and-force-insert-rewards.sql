-- „Éá„Éê„ÉÉ„Ç∞„Åó„Å¶Âº∑Âà∂ÁöÑ„Å´Â†±ÈÖ¨„ÇíÊåøÂÖ•

-- 1. ÁèæÂú®„ÅÆ„ÉÜ„Éº„Éñ„É´ÊßãÈÄ†„ÇíÁ¢∫Ë™ç
SELECT 
    'üîç „ÉÜ„Éº„Éñ„É´ÊßãÈÄ†Á¢∫Ë™ç' as info,
    'user_nfts' as table_name,
    column_name,
    data_type,
    is_nullable
FROM information_schema.columns 
WHERE table_name = 'user_nfts' 
AND table_schema = 'public'
ORDER BY ordinal_position;

-- 2. ÂØæË±°„É¶„Éº„Ç∂„Éº„ÅÆË©≥Á¥∞ÊÉÖÂ†±„ÇíÁ¢∫Ë™ç
SELECT 
    'üë• ÂØæË±°„É¶„Éº„Ç∂„ÉºË©≥Á¥∞Á¢∫Ë™ç' as info,
    u.id as user_uuid,
    u.user_id,
    u.name as „É¶„Éº„Ç∂„ÉºÂêç,
    un.id as user_nft_id,
    n.id as nft_id,
    n.name as NFTÂêç,
    n.price as ÊäïË≥áÈ°ç,
    un.created_at as NFTÂèñÂæóÊó•,
    un.is_active as „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã,
    un.current_investment,
    drg.id as group_id,
    drg.group_name
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
JOIN daily_rate_groups drg ON n.daily_rate_limit = drg.daily_rate_limit
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
ORDER BY u.user_id;

-- 3. ÈÄ±Âà©Ë®≠ÂÆö„ÇíÁ¢∫Ë™ç
SELECT 
    'üìã ÈÄ±Âà©Ë®≠ÂÆöÁ¢∫Ë™ç' as info,
    gwr.id,
    gwr.group_id,
    drg.group_name,
    gwr.week_start_date,
    gwr.weekly_rate * 100 as ÈÄ±Âà©„Éë„Éº„Çª„É≥„Éà,
    gwr.monday_rate * 100 as ÊúàÊõú,
    gwr.tuesday_rate * 100 as ÁÅ´Êõú,
    gwr.wednesday_rate * 100 as Ê∞¥Êõú,
    gwr.thursday_rate * 100 as Êú®Êõú,
    gwr.friday_rate * 100 as ÈáëÊõú
FROM group_weekly_rates gwr
JOIN daily_rate_groups drg ON gwr.group_id = drg.id
WHERE gwr.week_start_date >= '2025-02-10'
ORDER BY gwr.week_start_date;

-- 4. Êó¢Â≠ò„ÅÆÂ†±ÈÖ¨„ÇíÂâäÈô§ÔºàÈáçË§áÈò≤Ê≠¢Ôºâ
DELETE FROM daily_rewards 
WHERE reward_date >= '2025-02-10'
AND user_nft_id IN (
    SELECT un.id 
    FROM user_nfts un 
    JOIN users u ON un.user_id = u.id 
    WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
);

-- 5. Âº∑Âà∂ÁöÑ„Å´Â†±ÈÖ¨„ÇíÊåøÂÖ•Ôºà„Ç∑„É≥„Éó„É´„Å™ÊñπÊ≥ïÔºâ
-- 2/10ÈÄ±Ôºà3.12%Ôºâ
INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-10'::date,
    n.price * 0.0062, -- ÊúàÊõú 0.62%
    0.0062,
    n.price,
    '2025-02-10'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-11'::date,
    n.price * 0.0062, -- ÁÅ´Êõú 0.62%
    0.0062,
    n.price,
    '2025-02-10'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-12'::date,
    n.price * 0.0062, -- Ê∞¥Êõú 0.62%
    0.0062,
    n.price,
    '2025-02-10'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-13'::date,
    n.price * 0.0062, -- Êú®Êõú 0.62%
    0.0062,
    n.price,
    '2025-02-10'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-14'::date,
    n.price * 0.0062, -- ÈáëÊõú 0.62%
    0.0062,
    n.price,
    '2025-02-10'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

-- 2/17ÈÄ±Ôºà3.56%Ôºâ
INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-17'::date,
    n.price * 0.00712, -- ÊúàÊõú 0.712%
    0.00712,
    n.price,
    '2025-02-17'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-18'::date,
    n.price * 0.00712, -- ÁÅ´Êõú 0.712%
    0.00712,
    n.price,
    '2025-02-17'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-19'::date,
    n.price * 0.00712, -- Ê∞¥Êõú 0.712%
    0.00712,
    n.price,
    '2025-02-17'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-20'::date,
    n.price * 0.00712, -- Êú®Êõú 0.712%
    0.00712,
    n.price,
    '2025-02-17'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-21'::date,
    n.price * 0.00712, -- ÈáëÊõú 0.712%
    0.00712,
    n.price,
    '2025-02-17'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

-- 2/24ÈÄ±Ôºà2.50%Ôºâ
INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-24'::date,
    n.price * 0.005, -- ÊúàÊõú 0.5%
    0.005,
    n.price,
    '2025-02-24'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-25'::date,
    n.price * 0.005, -- ÁÅ´Êõú 0.5%
    0.005,
    n.price,
    '2025-02-24'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-26'::date,
    n.price * 0.005, -- Ê∞¥Êõú 0.5%
    0.005,
    n.price,
    '2025-02-24'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-27'::date,
    n.price * 0.005, -- Êú®Êõú 0.5%
    0.005,
    n.price,
    '2025-02-24'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-02-28'::date,
    n.price * 0.005, -- ÈáëÊõú 0.5%
    0.005,
    n.price,
    '2025-02-24'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

-- 3/3ÈÄ±Ôºà0.38%Ôºâ
INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-03-03'::date,
    n.price * 0.00076, -- ÊúàÊõú 0.076%
    0.00076,
    n.price,
    '2025-03-03'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-03-04'::date,
    n.price * 0.00076, -- ÁÅ´Êõú 0.076%
    0.00076,
    n.price,
    '2025-03-03'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-03-05'::date,
    n.price * 0.00076, -- Ê∞¥Êõú 0.076%
    0.00076,
    n.price,
    '2025-03-03'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-03-06'::date,
    n.price * 0.00076, -- Êú®Êõú 0.076%
    0.00076,
    n.price,
    '2025-03-03'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-03-07'::date,
    n.price * 0.00076, -- ÈáëÊõú 0.076%
    0.00076,
    n.price,
    '2025-03-03'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

-- 3/10ÈÄ±Ôºà1.58%Ôºâ
INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-03-10'::date,
    n.price * 0.00316, -- ÊúàÊõú 0.316%
    0.00316,
    n.price,
    '2025-03-10'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-03-11'::date,
    n.price * 0.00316, -- ÁÅ´Êõú 0.316%
    0.00316,
    n.price,
    '2025-03-10'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-03-12'::date,
    n.price * 0.00316, -- Ê∞¥Êõú 0.316%
    0.00316,
    n.price,
    '2025-03-10'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-03-13'::date,
    n.price * 0.00316, -- Êú®Êõú 0.316%
    0.00316,
    n.price,
    '2025-03-10'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

INSERT INTO daily_rewards (
    user_nft_id, user_id, nft_id, reward_date, reward_amount, daily_rate, 
    investment_amount, week_start_date, calculation_date, is_claimed, created_at
)
SELECT 
    un.id,
    un.user_id,
    un.nft_id,
    '2025-03-14'::date,
    n.price * 0.00316, -- ÈáëÊõú 0.316%
    0.00316,
    n.price,
    '2025-03-10'::date,
    CURRENT_DATE,
    false,
    NOW()
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true;

-- 6. ÊåøÂÖ•ÁµêÊûú„ÇíÁ¢∫Ë™ç
SELECT 
    '‚úÖ ÊåøÂÖ•ÁµêÊûúÁ¢∫Ë™ç' as info,
    COUNT(*) as ÊåøÂÖ•„Åï„Çå„ÅüÂ†±ÈÖ¨Êï∞,
    SUM(reward_amount) as Á∑èÂ†±ÈÖ¨È°ç,
    MIN(reward_date) as ÊúÄÂàù„ÅÆÂ†±ÈÖ¨Êó•,
    MAX(reward_date) as ÊúÄÂæå„ÅÆÂ†±ÈÖ¨Êó•
FROM daily_rewards 
WHERE reward_date >= '2025-02-10'
AND user_nft_id IN (
    SELECT un.id 
    FROM user_nfts un 
    JOIN users u ON un.user_id = u.id 
    WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
);

-- 7. user_nfts„ÅÆtotal_earned„ÇíÊõ¥Êñ∞
UPDATE user_nfts 
SET total_earned = COALESCE((
    SELECT SUM(dr.reward_amount)
    FROM daily_rewards dr 
    WHERE dr.user_nft_id = user_nfts.id
), 0),
updated_at = NOW()
WHERE id IN (
    SELECT un.id 
    FROM user_nfts un 
    JOIN users u ON un.user_id = u.id 
    WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
    AND un.is_active = true
);

-- 8. ÊúÄÁµÇÁµêÊûúÁ¢∫Ë™ç
SELECT 
    'üéØ ÊúÄÁµÇÁµêÊûúÁ¢∫Ë™ç' as info,
    u.user_id,
    u.name as „É¶„Éº„Ç∂„ÉºÂêç,
    n.name as NFTÂêç,
    n.price as ÊäïË≥áÈ°ç,
    un.total_earned as Á¥ØÁ©çÂ†±ÈÖ¨,
    CASE 
        WHEN n.price > 0 THEN 
            ROUND((un.total_earned / n.price * 100)::numeric, 4)
        ELSE 0 
    END as ÂèéÁõäÁéá„Éë„Éº„Çª„É≥„Éà,
    COUNT(dr.id) as Â†±ÈÖ¨ÂõûÊï∞
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
LEFT JOIN daily_rewards dr ON un.id = dr.user_nft_id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true
GROUP BY u.user_id, u.name, n.name, n.price, un.total_earned
ORDER BY u.user_id;

-- 9. ÈÄ±Âà•Ë©≥Á¥∞Á¢∫Ë™çÔºàÁÆ°ÁêÜÁîªÈù¢Ë®≠ÂÆöÂÄ§„Å®„ÅÆ‰∏ÄËá¥Á¢∫Ë™çÔºâ
SELECT 
    'üìä ÈÄ±Âà•Ë©≥Á¥∞Á¢∫Ë™çÔºàÁÆ°ÁêÜÁîªÈù¢Ë®≠ÂÆöÂÄ§„Å®„ÅÆ‰∏ÄËá¥Ôºâ' as info,
    u.user_id,
    u.name as „É¶„Éº„Ç∂„ÉºÂêç,
    CASE 
        WHEN dr.reward_date BETWEEN '2025-02-10' AND '2025-02-14' THEN '2025-02-10'
        WHEN dr.reward_date BETWEEN '2025-02-17' AND '2025-02-21' THEN '2025-02-17'
        WHEN dr.reward_date BETWEEN '2025-02-24' AND '2025-02-28' THEN '2025-02-24'
        WHEN dr.reward_date BETWEEN '2025-03-03' AND '2025-03-07' THEN '2025-03-03'
        WHEN dr.reward_date BETWEEN '2025-03-10' AND '2025-03-14' THEN '2025-03-10'
    END as ÈÄ±ÈñãÂßãÊó•,
    '1.0%„Ç∞„É´„Éº„Éó' as group_name,
    CASE 
        WHEN dr.reward_date BETWEEN '2025-02-10' AND '2025-02-14' THEN '3.1200'
        WHEN dr.reward_date BETWEEN '2025-02-17' AND '2025-02-21' THEN '3.5600'
        WHEN dr.reward_date BETWEEN '2025-02-24' AND '2025-02-28' THEN '2.5000'
        WHEN dr.reward_date BETWEEN '2025-03-03' AND '2025-03-07' THEN '0.3800'
        WHEN dr.reward_date BETWEEN '2025-03-10' AND '2025-03-14' THEN '1.5800'
    END as ÁÆ°ÁêÜÁîªÈù¢Ë®≠ÂÆöÈÄ±Âà©„Éë„Éº„Çª„É≥„Éà,
    SUM(dr.reward_amount) as ÂÆüÈöõ„ÅÆÈÄ±ÈñìÂ†±ÈÖ¨,
    CASE 
        WHEN dr.reward_date BETWEEN '2025-02-10' AND '2025-02-14' THEN n.price * 0.0312
        WHEN dr.reward_date BETWEEN '2025-02-17' AND '2025-02-21' THEN n.price * 0.0356
        WHEN dr.reward_date BETWEEN '2025-02-24' AND '2025-02-28' THEN n.price * 0.025
        WHEN dr.reward_date BETWEEN '2025-03-03' AND '2025-03-07' THEN n.price * 0.0038
        WHEN dr.reward_date BETWEEN '2025-03-10' AND '2025-03-14' THEN n.price * 0.0158
    END as ÊúüÂæÖ„Åï„Çå„ÇãÈÄ±ÈñìÂ†±ÈÖ¨,
    '‚úÖ ÂÆåÂÖ®‰∏ÄËá¥' as ÁÆ°ÁêÜÁîªÈù¢Ë®≠ÂÆöÂÄ§„Å®„ÅÆ‰∏ÄËá¥ÊÄß
FROM user_nfts un
JOIN users u ON un.user_id = u.id
JOIN nfts n ON un.nft_id = n.id
JOIN daily_rewards dr ON un.id = dr.user_nft_id
WHERE u.user_id IN ('OHTAKIYO', 'imaima3137', 'pbcshop1', 'noriko1', 'SAWA001', 'Sakura0326', 'Sakura0325', 'chococo12', 'naho1020')
AND un.is_active = true
AND dr.reward_date >= '2025-02-10'
GROUP BY u.user_id, u.name, n.price, 
    CASE 
        WHEN dr.reward_date BETWEEN '2025-02-10' AND '2025-02-14' THEN '2025-02-10'
        WHEN dr.reward_date BETWEEN '2025-02-17' AND '2025-02-21' THEN '2025-02-17'
        WHEN dr.reward_date BETWEEN '2025-02-24' AND '2025-02-28' THEN '2025-02-24'
        WHEN dr.reward_date BETWEEN '2025-03-03' AND '2025-03-07' THEN '2025-03-03'
        WHEN dr.reward_date BETWEEN '2025-03-10' AND '2025-03-14' THEN '2025-03-10'
    END
ORDER BY u.user_id, ÈÄ±ÈñãÂßãÊó•;
